<div class="wrap">
  <h1>âš¡ {{ title }}</h1>


  <div class="row">
    <label>Baud:</label>
    <!--    <input type="number" [(ngModel)]="baud" min="110" step="1"/>-->

    <select [(ngModel)]="baud">
      <option [value]="300">300 baud</option>
      <option [value]="600">600 baud</option>
      <option [value]="750">750 baud</option>
      <option [value]="1200">1200 baud</option>
      <option [value]="2400">2400 baud</option>
      <option [value]="4800">4800 baud</option>
      <option [value]="9600">9600 baud</option>
      <option [value]="19200">19200 baud</option>
      <option [value]="31250">31250 baud</option>
      <option [value]="38400">38400 baud</option>
      <option [value]="57600">57600 baud</option>
      <option [value]="74880">74880 baud</option>
      <option [value]="115200" selected>115200 baud</option>
      <option [value]="230400">230400 baud</option>
      <option [value]="250000">250000 baud</option>
      <option [value]="460800">460800 baud</option>
      <option [value]="921600">921600 baud</option>
      <option [value]="1000000">1000000 baud</option>
      <option [value]="2000000">2000000 baud</option>
    </select>
    <button
      (click)="quickConnect()"
      [disabled]="serial.connected$.value || !serial.pairedPortsAvailable$.value || !serial.isSupported">
      Quick connect
    </button>
    <!--    <button (click)="quickConnect()" [disabled]="serial.connected$.value || !serial.isSupported">Quick connect</button>-->
    <button (click)="connect()" [disabled]="serial.connected$.value || !serial.isSupported">Choose portâ€¦</button>
    <button (click)="disconnect()" [disabled]="!serial.connected$.value">Disconnect</button>

    <div class="history-controls">
      <button type="button" (click)="openHistoryDialog()">View history</button>
      <button type="button" (click)="clearHistoryAll()">Clear history</button>
    </div>

  </div>


  @if (!serial.isSupported) {
    <p class="warn">
      Web Serial API is not supported in this browser. Use Chrome/Edge over HTTPS or localhost.
    </p>
  }

  <textarea id="logArea" readonly [value]="log" spellcheck="false"></textarea>

  <div class="row">
    <input
      #cmdInput
      type="text"
      [(ngModel)]="inputText"
      placeholder="Send a lineâ€¦"
      (keyup.enter)="sendLine()"
      (keydown)="handleKeyDown($event)"
      class="command-input"
      autofocus
    />
    <!--    <input-->
    <!--      type="text"-->
    <!--      [(ngModel)]="inputText"-->
    <!--      placeholder="Send a lineâ€¦"-->
    <!--      (keyup.enter)="sendLine()"-->
    <!--      (keydown)="handleKeyDown($event)"-->
    <!--      class="command-input"-->
    <!--    />-->
    <button (click)="sendLine()" [disabled]="!serial.connected$.value">Send</button>
    <button (click)="clearLog()">Clear</button>
  </div>

  <!--  <div class="row">-->
  <!--    <input type="text" [(ngModel)]="inputText" placeholder="Send a lineâ€¦" (keyup.enter)="sendLine()"/>-->
  <!--    <button (click)="sendLine()" [disabled]="!serial.connected$.value">Send</button>-->
  <!--    <button (click)="clearLog()">Clear</button>-->
  <!--  </div>-->

  <dialog #historyDialog class="history-dialog">
    <header>
      <h3>Command History</h3>
      <button type="button" (click)="closeHistoryDialog()" aria-label="Close">âœ•</button>
    </header>

    <div class="history-list">
      @if (commandHistory.length > 0) {
        <ul>
          @for (cmd of commandHistory; track cmd; let i = $index) {
            <li>
              <code>{{ cmd }}</code>
              <span class="spacer"></span>
              <button type="button" (click)="reuseHistoryItem(cmd)">ðŸ“‹ Use</button>
              <button type="button"
                      (click)="reuseAndSend(cmd)"
                      [disabled]="!serial.connected$.value"
                      title="Use and send immediately">
                ðŸš€ Use + Send
              </button>
              <button type="button"
                      (click)="deleteHistoryAt(i)"
                      title="Delete this entry">ðŸ—‘
              </button>
            </li>
          }
        </ul>
      } @else {
        <p>No saved commands yet.</p>
      }
    </div>

    <footer>
      <button type="button" (click)="clearHistoryAll()">Clear all</button>
      <button type="button" (click)="closeHistoryDialog()">Close</button>
    </footer>
  </dialog>


</div>
